# 85. Критерий остановки в методе проекции градиента Розена

## Основные условия остановки

### 1. Проверка направления спуска
Вычисляем проекцию градиента:  
$ P\nabla f(x) = (I - M^T(MM^T)^{-1}M)\nabla f(x) $

**Критерии**:
- Если $ P\nabla f(x) \neq 0 $:
  - Направление $ s = -P\nabla f(x) $ является возможным направлением спуска
  - Продолжаем итерационный процесс

- Если $ P\nabla f(x) = 0 $:
  - Переходим к проверке условий оптимальности

### 2. Анализ условий Куна-Таккера
При $ P\nabla f(x) = 0 $ имеем:  
$ \nabla f(x) + M^T\omega = 0 $  
где:  
$ \omega = -(MM^T)^{-1}M\nabla f(x) = \begin{pmatrix} u \\ v \end{pmatrix} $

**Составляющие**:
- $ u $ - множители Лагранжа для активных ограничений-неравенств
- $ v $ - множители Лагранжа для ограничений-равенств

**Критерий оптимальности**:
- Если $ u \geq 0 $ (все компоненты неотрицательны):
  - Точка $ x $ удовлетворяет условиям Куна-Таккера
  - Алгоритм завершается

- Если ∃ $ u_i < 0 $:
  - Исключаем соответствующее ограничение из активного набора
  - Пересчитываем матрицу проектирования

### 3. Пересчет проекционной матрицы
Для нового набора активных ограничений $ \hat{A}_1 $:  
$ \hat{M} = \begin{pmatrix} \hat{A}_1 \\ H \end{pmatrix} $  
$ \hat{P} = I - \hat{M}^T(\hat{M}\hat{M}^T)^{-1}\hat{M} $

Новое направление спуска:
$ \hat{s} = -\hat{P}\nabla f(x) $

## Формальные условия Куна-Таккера
В оптимальной точке должно выполняться:  
$ \nabla f(x) + \sum_{i \in I(x)} u_i\nabla g_i(x) + \sum_{j=1}^l v_j\nabla h_j(x) = 0 $
где:
- $ I(x) $ - множество активных ограничений
- $ u_i \geq 0 $ для всех $ i \in I(x) $

## Алгоритм работы метода
1. Вычислить $$ P\nabla f(x) $$
2. Если $$ P\nabla f(x) \neq 0 $$ - сделать шаг в направлении $$ -P\nabla f(x) $$
3. Если $ P\nabla f(x) = 0 $:
   - Проверить знаки множителей $ u $
   - Если все $ u_i \geq 0 $ - останов
   - Иначе - исключить ограничения с отрицательными $ u_i $ и повторить

## Пример проверки условий
Пусть в текущей точке:
$$ \nabla f(x) = \begin{pmatrix} 2 \\ -1 \end{pmatrix}, \quad u = \begin{pmatrix} -0.5 \\ 1.2 \end{pmatrix} $$

Решение:
1. Обнаруживаем $$ u_1 = -0.5 < 0 $$
2. Исключаем первое ограничение из активного набора
3. Пересчитываем матрицу проектирования
4. Продолжаем поиск с новым набором активных ограничений